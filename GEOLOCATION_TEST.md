# Тестирование геолокации на странице /map

## Что было исправлено:

### 1. **Увеличен таймаут запроса геолокации**
- С 10 секунд до **15 секунд**
- Это дает больше времени пользователю нажать "Разрешить"

### 2. **Добавлено кеширование геолокации**
- `maximumAge: 30000` (30 секунд)
- Позволяет использовать недавно полученные координаты

### 3. **Детальные сообщения об ошибках**
Теперь показываются конкретные причины:
- "Вы отклонили запрос на доступ к геолокации"
- "Информация о местоположении недоступна"
- "Превышено время ожидания запроса геолокации"

### 4. **Улучшенный UI**
- Индикатор загрузки при повторном запросе
- Блок с инструкциями по включению геолокации для разных браузеров
- Анимированная иконка ошибки

### 5. **Непрерывное отслеживание позиции**
- Используется `watchPosition` вместо `getCurrentPosition`
- Позиция пользователя обновляется автоматически при движении
- Fallback на одноразовый запрос при ошибке

## Как тестировать:

### Тест 1: Первый вход
1. Откройте `/map` в режиме инкогнито
2. Должен появиться запрос браузера на доступ к геолокации
3. Нажмите "Разрешить"
4. Карта должна загрузиться с вашей позицией

### Тест 2: Отказ от геолокации
1. Откройте `/map` в режиме инкогнито
2. Нажмите "Заблокировать" в запросе браузера
3. Должен появиться экран с красной иконкой и кнопкой
4. В красном блоке должно быть сообщение: "Вы отклонили запрос на доступ к геолокации"

### Тест 3: Повторный запрос
1. После отказа нажмите кнопку "Разрешить доступ к геолокации"
2. Кнопка должна показать спиннер и текст "Ожидание..."
3. Если разрешите - карта загрузится

### Тест 4: Safari на iOS
1. Откройте Settings → Safari → Location
2. Установите "Ask" для сайта
3. Откройте `/map`
4. Разрешите доступ

### Тест 5: Chrome на Android
1. Настройки → Сайты → Геоданные
2. Разрешите доступ для сайта
3. Откройте `/map`
4. Карта должна загрузиться автоматически

## Размер осколков:
- Увеличен с **50px до 80px** (+ 60%)
- Теперь гораздо заметнее на карте
- Улучшена тень для контраста

## Debug в консоли:
При успешном получении геолокации в консоли появится:
```
Геолокация получена: {latitude: ..., longitude: ...}
Позиция обновлена: ... ...
```

При ошибке:
```
Ошибка получения геолокации: GeolocationPositionError
```
